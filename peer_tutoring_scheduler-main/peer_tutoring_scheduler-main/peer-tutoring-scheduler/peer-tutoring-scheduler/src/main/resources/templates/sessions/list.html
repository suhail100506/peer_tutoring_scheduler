<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Session List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4">
            <div class="d-flex align-items-center gap-3">
                <h1 class="h2 fw-bold text-warning mb-1">Session Scheduler</h1>
                <p class="text-muted mb-0">Monitor upcoming tutoring sessions and keep schedules organized.</p>
            </div>
            <div class="mt-3 mt-md-0 d-flex align-items-center gap-2">
                <button type="button" class="theme-toggle" data-toggle-theme aria-label="Toggle theme">
                    <i class="bi"></i>
                </button>
                <a th:href="@{/sessions/new}" class="btn btn-warning btn-lg text-dark shadow-sm">
                    <i class="bi bi-calendar-plus"></i>
                    <span class="ms-2">New Session</span>
                </a>
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-12 col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted mb-2">Total Sessions</h6>
                        <h3 class="fw-bold" th:text="${sessions.size()}">32</h3>
                        <p class="text-muted small mb-0">All scheduled and completed sessions.</p>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted mb-2">Upcoming</h6>
                        <div class="d-flex align-items-center">
                            <span class="display-6 text-warning me-3" th:text="${sessions.?[status == 'SCHEDULED'].size()}">12</span>
                            <p class="text-muted small mb-0">Sessions awaiting completion.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted mb-2">Reminders</h6>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-1">‚è∞ Confirm attendance 24h before</li>
                            <li class="mb-1">üéØ Align goals for each session</li>
                            <li>üìù Capture post-session notes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-12 col-lg-4">
                        <label for="sessionSearch" class="form-label text-muted text-uppercase small mb-1">Search</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                            <input type="text" id="sessionSearch" class="form-control" placeholder="Search by subject, tutor, or student">
                        </div>
                    </div>
                    <div class="col-12 col-lg-3">
                        <label for="statusFilter" class="form-label text-muted text-uppercase small mb-1">Status</label>
                        <select id="statusFilter" class="form-select">
                            <option value="">All statuses</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="col-12 col-lg-2">
                        <label for="dateFrom" class="form-label text-muted text-uppercase small mb-1">From</label>
                        <input type="date" id="dateFrom" class="form-control">
                    </div>
                    <div class="col-12 col-lg-2">
                        <label for="dateTo" class="form-label text-muted text-uppercase small mb-1">To</label>
                        <input type="date" id="dateTo" class="form-control">
                    </div>
                    <div class="col-12 col-lg-1 d-flex align-items-end">
                        <button type="button" id="clearFilters" class="btn btn-outline-warning w-100">Reset</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-4" th:if="${sessions.size()} > 0">
            <div class="col-12">
                <h2 class="h5 text-muted text-uppercase">Upcoming Sessions</h2>
            </div>
            <div class="col-12 col-lg-4" th:each="session, iterStat : ${sessions}" th:if="${session.status == 'SCHEDULED' && iterStat.index < 3}">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-warning text-dark">Scheduled</span>
                            <span class="text-muted small" th:text="${#dates.format(session.startTime, 'dd MMM')}">21 Oct</span>
                        </div>
                        <h3 class="h5 mb-1" th:text="${session.subject != null ? session.subject : 'Session'}">Physics</h3>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-person-video2 me-1"></i>
                            <span th:text="${session.tutor.name}">Tutor</span>
                            <span class="mx-1">‚Ä¢</span>
                            <i class="bi bi-person me-1"></i>
                            <span th:text="${session.student.name}">Student</span>
                        </p>
                        <p class="text-muted small mb-0">
                            <i class="bi bi-clock me-1"></i>
                            <span th:text="${#dates.format(session.startTime, 'HH:mm')} + ' - ' + #dates.format(session.endTime, 'HH:mm')}">15:00 - 16:00</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-3">
                    <h2 class="h4 mb-3 mb-md-0">Scheduled Sessions</h2>
                    <p class="text-muted small mb-0">Use the filters above to refine the list.</p>
                </div>

                <div class="table-responsive">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Subject</th>
                                <th scope="col">Tutor</th>
                                <th scope="col">Student</th>
                                <th scope="col">Date</th>
                                <th scope="col">Time</th>
                                <th scope="col">Status</th>
                                <th scope="col" class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="session : ${sessions}" class="border-bottom session-row"
                                th:attr="data-subject=${session.subject},data-tutor=${session.tutor.name},data-student=${session.student.name},data-status=${session.status},data-date=${#dates.format(session.startTime, 'yyyy-MM-dd')}">
                                <td class="fw-semibold" th:text="${session.id}">1</td>
                                <td th:text="${session.subject}">Physics</td>
                                <td th:text="${session.tutor.name}">Alex Carter</td>
                                <td th:text="${session.student.name}">Emily Johnson</td>
                                <td th:text="${#dates.format(session.startTime, 'dd MMM yyyy')}">21 Oct 2025</td>
                                <td>
                                    <span th:text="${#dates.format(session.startTime, 'HH:mm')} + ' - ' + #dates.format(session.endTime, 'HH:mm')}">15:00 - 16:00</span>
                                </td>
                                <td>
                                    <span class="badge" th:classappend="${session.status == 'SCHEDULED'} ? ' bg-warning text-dark' : ' bg-success'" th:text="${session.status}">SCHEDULED</span>
                                </td>
                                <td class="text-end">
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/sessions/edit/} + ${session.id}" class="btn btn-outline-secondary btn-sm">Edit</a>
                                        <a th:href="@{/sessions/delete/} + ${session.id}" class="btn btn-outline-danger btn-sm"
                                           onclick="return confirm('Are you sure you want to delete this session?')">Delete</a>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${sessions.size()} == 0">
                                <td colspan="8" class="text-center text-muted py-4">
                                    No sessions scheduled. Click "New Session" to plan one.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/theme.js"></script>
    <script>
        (function () {
            const rows = Array.from(document.querySelectorAll('.session-row'));
            const searchInput = document.getElementById('sessionSearch');
            const statusFilter = document.getElementById('statusFilter');
            const dateFrom = document.getElementById('dateFrom');
            const dateTo = document.getElementById('dateTo');
            const clearButton = document.getElementById('clearFilters');

            function normalize(value) {
                return (value || '').toString().toLowerCase().trim();
            }

            function withinDateRange(dateValue) {
                if (!dateValue) return true;
                const from = dateFrom.value ? new Date(dateFrom.value) : null;
                const to = dateTo.value ? new Date(dateTo.value) : null;
                const sessionDate = new Date(dateValue + 'T00:00:00');
                if (from && sessionDate < from) return false;
                if (to && sessionDate > to) return false;
                return true;
            }

            function applyFilters() {
                const searchTerm = normalize(searchInput.value);
                const statusTerm = normalize(statusFilter.value);

                rows.forEach(row => {
                    const subject = normalize(row.dataset.subject);
                    const tutor = normalize(row.dataset.tutor);
                    const student = normalize(row.dataset.student);
                    const status = normalize(row.dataset.status);
                    const date = row.dataset.date;

                    const matchesSearch = !searchTerm || subject.includes(searchTerm) || tutor.includes(searchTerm) || student.includes(searchTerm);
                    const matchesStatus = !statusTerm || status === statusTerm;
                    const matchesDate = withinDateRange(date);

                    row.style.display = (matchesSearch && matchesStatus && matchesDate) ? '' : 'none';
                });
            }

            searchInput?.addEventListener('input', applyFilters);
            statusFilter?.addEventListener('change', applyFilters);
            dateFrom?.addEventListener('change', applyFilters);
            dateTo?.addEventListener('change', applyFilters);
            clearButton?.addEventListener('click', () => {
                searchInput.value = '';
                statusFilter.value = '';
                dateFrom.value = '';
                dateTo.value = '';
                applyFilters();
            });
        })();
    </script>
</body>
</html>
